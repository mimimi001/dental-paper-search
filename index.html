<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歯科系ガイドライン・論文検索</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;
            background-color: #f8f9fa;
        }
        .header {
            background-color: #0d6efd;
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
        }
        .search-panel {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .results-panel {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        .result-item {
            border-bottom: 1px solid #dee2e6;
            padding: 15px 0;
        }
        .result-item:last-child {
            border-bottom: none;
        }
        .badge-evidence {
            font-size: 0.8rem;
            padding: 5px 10px;
        }
        .badge-language {
            font-size: 0.8rem;
            padding: 5px 10px;
        }
        .downloaded {
            background-color: #e9f5e9;
        }
        .btn-download {
            min-width: 120px;
        }
        .society-link {
            margin-top: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        @media (max-width: 768px) {
            .search-panel, .results-panel {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1 class="text-center">歯科系ガイドライン・論文検索</h1>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <!-- 検索パネル -->
            <div class="col-md-4">
                <div class="search-panel">
                    <h4 class="mb-3">検索条件</h4>
                    <form id="searchForm">
                        <div class="mb-3">
                            <label for="keyword" class="form-label">キーワード</label>
                            <input type="text" class="form-control" id="keyword" placeholder="キーワードを入力">
                        </div>
                        
                        <div class="mb-3">
                            <label for="field" class="form-label">分野</label>
                            <select class="form-select" id="field">
                                <option value="all">すべての分野</option>
                                <option value="adhesive">接着修復</option>
                                <option value="conservative">保存歯科</option>
                                <option value="endodontics">歯内療法</option>
                                <option value="periodontics">歯周病</option>
                                <option value="orthodontics">矯正</option>
                                <option value="pediatric">小児歯科</option>
                                <option value="oral-surgery">口腔外科</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="documentType" class="form-label">文献タイプ</label>
                            <select class="form-select" id="documentType">
                                <option value="all">すべての文献</option>
                                <option value="guideline">ガイドライン</option>
                                <option value="paper">論文（エビデンスレベルの高いもの）</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="language" class="form-label">言語</label>
                            <select class="form-select" id="language">
                                <option value="all">すべての言語</option>
                                <option value="ja">日本語</option>
                                <option value="en">英語</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="society" class="form-label">学会</label>
                            <select class="form-select" id="society">
                                <option value="all">すべての学会</option>
                                <option value="jea">日本歯内療法学会</option>
                                <option value="jscd">日本保存歯科学会</option>
                                <option value="jadr">日本接着歯学会</option>
                                <option value="jspp">日本歯周病学会</option>
                                <option value="jos">日本矯正歯科学会</option>
                                <option value="jspd">日本小児歯科学会</option>
                                <option value="jsoms">日本口腔外科学会</option>
                                <option value="ada">アメリカ歯科医師会</option>
                                <option value="aae">アメリカ歯内療法学会</option>
                            </select>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100">検索</button>
                    </form>
                </div>
                
                <div class="society-link">
                    <h5>主要学会リンク</h5>
                    <ul class="list-unstyled">
                        <li><a href="https://jea-endo.or.jp/" target="_blank">日本歯内療法学会</a></li>
                        <li><a href="https://www.hozon.or.jp/" target="_blank">日本保存歯科学会</a></li>
                        <li><a href="https://www.adhesive-dent.com/" target="_blank">日本接着歯学会</a></li>
                        <li><a href="https://www.perio.jp/" target="_blank">日本歯周病学会</a></li>
                        <li><a href="https://www.jos.gr.jp/" target="_blank">日本矯正歯科学会</a></li>
                        <li><a href="http://www.jspd.or.jp/" target="_blank">日本小児歯科学会</a></li>
                        <li><a href="https://www.jsoms.or.jp/" target="_blank">日本口腔外科学会</a></li>
                        <li><a href="https://www.ada.org/" target="_blank">アメリカ歯科医師会</a></li>
                        <li><a href="https://www.aae.org/" target="_blank">アメリカ歯内療法学会</a></li>
                    </ul>
                </div>
            </div>
            
            <!-- 検索結果パネル -->
            <div class="col-md-8">
                <div class="results-panel">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h4>検索結果</h4>
                        <button id="bulkDownload" class="btn btn-success" style="display: none;">一括ダウンロード</button>
                    </div>
                    <div id="searchResults">
                        <p class="text-center text-muted">検索条件を設定して「検索」ボタンをクリックしてください。</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ダウンロード済みアイテムを保存するローカルストレージキー
        const DOWNLOADED_ITEMS_KEY = 'downloadedDentalItems';
        
        // ダウンロード済みアイテムの取得
        function getDownloadedItems() {
            const items = localStorage.getItem(DOWNLOADED_ITEMS_KEY);
            return items ? JSON.parse(items) : [];
        }
        
        // ダウンロード済みアイテムの保存
        function saveDownloadedItem(id) {
            const items = getDownloadedItems();
            if (!items.includes(id)) {
                items.push(id);
                localStorage.setItem(DOWNLOADED_ITEMS_KEY, JSON.stringify(items));
            }
        }
        
        // アイテムがダウンロード済みかチェック
        function isItemDownloaded(id) {
            return getDownloadedItems().includes(id);
        }
        
        // モックデータ - 実際のAPIに置き換えることができます
        const mockData = [
            // 日本歯内療法学会のガイドライン
            {
                id: 'jea-guideline-2020',
                title: '歯内療法診療ガイドライン',
                authors: '日本歯内療法学会',
                journal: '日本歯内療法学会',
                date: '2020-06',
                type: 'guideline',
                field: 'endodontics',
                language: 'ja',
                society: 'jea',
                url: 'https://jea-endo.or.jp/materials/guidelines.html',
                pdfUrl: 'https://jea-endo.or.jp/materials/guidelines.html'
            },
            {
                id: 'jea-guideline-2009',
                title: '歯内療法ガイドライン',
                authors: '日本歯内療法学会',
                journal: '日本歯内療法学会',
                date: '2009',
                type: 'guideline',
                field: 'endodontics',
                language: 'ja',
                society: 'jea',
                url: 'https://jea-endo.or.jp/materials/guidelines.html',
                pdfUrl: 'https://jea-endo.or.jp/materials/guidelines.html'
            },
            {
                id: 'jea-aae-antibiotics',
                title: '歯内療法における抗生物質の使用に関するAAEガイダンス',
                authors: 'アメリカ歯内療法学会（日本語訳：日本歯内療法学会）',
                journal: '日本歯内療法学会',
                date: '2017',
                type: 'guideline',
                field: 'endodontics',
                language: 'ja',
                society: 'jea',
                url: 'https://jea-endo.or.jp/materials/guidelines.html',
                pdfUrl: 'https://jea-endo.or.jp/materials/guidelines.html'
            },
            {
                id: 'jea-aae-prophylaxis',
                title: '全身疾患のある患者への抗菌薬予防投与におけるAAEの手引き',
                authors: 'アメリカ歯内療法学会（日本語訳：日本歯内療法学会）',
                journal: '日本歯内療法学会',
                date: '2017',
                type: 'guideline',
                field: 'endodontics',
                language: 'ja',
                society: 'jea',
                url: 'https://jea-endo.or.jp/materials/guidelines.html',
                pdfUrl: 'https://jea-endo.or.jp/materials/guidelines.html'
            },
            
            // 日本保存歯科学会のガイドライン
            {
                id: 'jscd-guideline-2019',
                title: 'う蝕治療ガイドライン',
                authors: '日本保存歯科学会',
                journal: '日本保存歯科学会',
                date: '2019',
                type: 'guideline',
                field: 'conservative',
                language: 'ja',
                society: 'jscd',
                url: 'https://www.hozon.or.jp/member/publication/guideline/',
                pdfUrl: 'https://www.hozon.or.jp/member/publication/guideline/'
            },
            {
                id: 'jscd-guideline-2015',
                title: 'MI（Minimal Intervention）を理念としたエビデンス（根拠）とコンセンサス（合意）に基づくう蝕治療ガイドライン',
                authors: '日本保存歯科学会',
                journal: '日本保存歯科学会',
                date: '2015',
                type: 'guideline',
                field: 'conservative',
                language: 'ja',
                society: 'jscd',
                url: 'https://www.hozon.or.jp/member/publication/guideline/',
                pdfUrl: 'https://www.hozon.or.jp/member/publication/guideline/'
            },
            
            // 日本接着歯学会のガイドライン
            {
                id: 'jadr-guideline-2018',
                title: '接着歯学臨床ガイドライン',
                authors: '日本接着歯学会',
                journal: '日本接着歯学会',
                date: '2018',
                type: 'guideline',
                field: 'adhesive',
                language: 'ja',
                society: 'jadr',
                url: 'https://www.adhesive-dent.com/guideline/',
                pdfUrl: 'https://www.adhesive-dent.com/guideline/'
            },
            
            // 日本歯周病学会のガイドライン
            {
                id: 'jspp-guideline-2022',
                title: '歯周病患者における再生療法の指針',
                authors: '日本歯周病学会',
                journal: '日本歯周病学会',
                date: '2022',
                type: 'guideline',
                field: 'periodontics',
                language: 'ja',
                society: 'jspp',
                url: 'https://www.perio.jp/publication/guideline.shtml',
                pdfUrl: 'https://www.perio.jp/publication/guideline.shtml'
            },
            {
                id: 'jspp-guideline-2015',
                title: '歯周病患者における抗菌療法の指針',
                authors: '日本歯周病学会',
                journal: '日本歯周病学会',
                date: '2015',
                type: 'guideline',
                field: 'periodontics',
                language: 'ja',
                society: 'jspp',
                url: 'https://www.perio.jp/publication/guideline.shtml',
                pdfUrl: 'https://www.perio.jp/publication/guideline.shtml'
            },
            
            // 日本矯正歯科学会のガイドライン
            {
                id: 'jos-guideline-2020',
                title: '矯正歯科治療における感染症対策ガイドライン',
                authors: '日本矯正歯科学会',
                journal: '日本矯正歯科学会',
                date: '2020',
                type: 'guideline',
                field: 'orthodontics',
                language: 'ja',
                society: 'jos',
                url: 'https://www.jos.gr.jp/medical/guideline/',
                pdfUrl: 'https://www.jos.gr.jp/medical/guideline/'
            },
            
            // 日本小児歯科学会のガイドライン
            {
                id: 'jspd-guideline-2018',
                title: '小児の歯冠修復治療ガイドライン',
                authors: '日本小児歯科学会',
                journal: '日本小児歯科学会',
                date: '2018',
                type: 'guideline',
                field: 'pediatric',
                language: 'ja',
                society: 'jspd',
                url: 'http://www.jspd.or.jp/contents/main/proposal/',
                pdfUrl: 'http://www.jspd.or.jp/contents/main/proposal/'
            },
            
            // 日本口腔外科学会のガイドライン
            {
                id: 'jsoms-guideline-2021',
                title: '口腔外科ハンドブック',
                authors: '日本口腔外科学会',
                journal: '日本口腔外科学会',
                date: '2021',
                type: 'guideline',
                field: 'oral-surgery',
                language: 'ja',
                society: 'jsoms',
                url: 'https://www.jsoms.or.jp/medical/guideline/',
                pdfUrl: 'https://www.jsoms.or.jp/medical/guideline/'
            },
            
            // アメリカ歯科医師会のガイドライン
            {
                id: 'ada-guideline-2022',
                title: 'Clinical Practice Guidelines on Antibiotic Use',
                authors: 'American Dental Association',
                journal: 'Journal of the American Dental Association',
                date: '2022',
                type: 'guideline',
                field: 'conservative',
                language: 'en',
                society: 'ada',
                url: 'https://www.ada.org/resources/research/science/evidence-based-dental-research',
                pdfUrl: 'https://www.ada.org/resources/research/science/evidence-based-dental-research'
            },
            
            // アメリカ歯内療法学会のガイドライン
            {
                id: 'aae-guideline-2020',
                title: 'AAE Position Statement on the Use of Systemic Antibiotics in Endodontics',
                authors: 'American Association of Endodontists',
                journal: 'Journal of Endodontics',
                date: '2020',
                type: 'guideline',
                field: 'endodontics',
                language: 'en',
                society: 'aae',
                url: 'https://www.aae.org/specialty/clinical-resources/guidelines-position-statements/',
                pdfUrl: 'https://www.aae.org/specialty/clinical-resources/guidelines-position-statements/'
            },
            
            // 高エビデンスレベルの論文（システマティックレビュー、RCT、高インパクトファクター）
            {
                id: 'paper-sr-endo-2022',
                title: '根管治療後の疼痛管理におけるNSAIDsの有効性：システマティックレビューとメタアナリシス',
                authors: '山田太郎, 鈴木一郎, 佐藤次郎',
                journal: '日本歯科保存学雑誌',
                date: '2022',
                type: 'paper',
                field: 'endodontics',
                language: 'ja',
                society: 'jscd',
                url: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/',
                pdfUrl: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/'
            },
            {
                id: 'paper-rct-perio-2021',
                title: '慢性歯周炎患者に対するスケーリング・ルートプレーニングと抗菌薬併用療法の効果：ランダム化比較試験',
                authors: '田中一郎, 伊藤二郎, 高橋三郎',
                journal: '日本歯周病学会会誌',
                date: '2021',
                type: 'paper',
                field: 'periodontics',
                language: 'ja',
                society: 'jspp',
                url: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/',
                pdfUrl: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/'
            },
            {
                id: 'paper-sr-adhesive-2020',
                title: 'コンポジットレジン修復におけるユニバーサルアドヒーシブの臨床成績：システマティックレビュー',
                authors: '佐々木一郎, 高橋二郎, 鈴木三郎',
                journal: '接着歯学',
                date: '2020',
                type: 'paper',
                field: 'adhesive',
                language: 'ja',
                society: 'jadr',
                url: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/',
                pdfUrl: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/'
            },
            {
                id: 'paper-rct-ortho-2021',
                title: '矯正治療中の疼痛管理におけるレーザー療法の効果：ランダム化比較試験',
                authors: '伊藤一郎, 佐藤二郎, 田中三郎',
                journal: '日本矯正歯科学会雑誌',
                date: '2021',
                type: 'paper',
                field: 'orthodontics',
                language: 'ja',
                society: 'jos',
                url: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/',
                pdfUrl: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/'
            },
            {
                id: 'paper-sr-pediatric-2022',
                title: '小児における予防的シーラント材の長期臨床成績：システマティックレビュー',
                authors: '山本一郎, 鈴木二郎, 佐藤三郎',
                journal: '小児歯科学雑誌',
                date: '2022',
                type: 'paper',
                field: 'pediatric',
                language: 'ja',
                society: 'jspd',
                url: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/',
                pdfUrl: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/'
            },
            {
                id: 'paper-rct-surgery-2021',
                title: '下顎智歯抜歯後の疼痛管理におけるデキサメタゾンの効果：ランダム化比較試験',
                authors: '高橋一郎, 伊藤二郎, 佐藤三郎',
                journal: '日本口腔外科学会雑誌',
                date: '2021',
                type: 'paper',
                field: 'oral-surgery',
                language: 'ja',
                society: 'jsoms',
                url: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/',
                pdfUrl: 'https://www.jstage.jst.go.jp/browse/jjcp/-char/ja/'
            },
            {
                id: 'paper-sr-endo-en-2022',
                title: 'Effectiveness of Calcium Silicate-Based Materials in Endodontic Treatment: A Systematic Review and Meta-analysis',
                authors: 'Smith J, Johnson R, Williams T',
                journal: 'Journal of Endodontics',
                date: '2022',
                type: 'paper',
                field: 'endodontics',
                language: 'en',
                society: 'aae',
                url: 'https://www.jendodon.com/',
                pdfUrl: 'https://www.jendodon.com/'
            },
            {
                id: 'paper-rct-perio-en-2021',
                title: 'Clinical Efficacy of Probiotics as an Adjunct to Scaling and Root Planing in Patients with Chronic Periodontitis: A Randomized Controlled Trial',
                authors: 'Brown A, Davis B, Wilson C',
                journal: 'Journal of Periodontology',
                date: '2021',
                type: 'paper',
                field: 'periodontics',
                language: 'en',
                society: 'ada',
                url: 'https://aap.onlinelibrary.wiley.com/journal/19433670',
                pdfUrl: 'https://aap.onlinelibrary.wiley.com/journal/19433670'
            }
        ];
        
        // 検索フォームの送信イベント
        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 検索条件の取得
            const keyword = document.getElementById('keyword').value.toLowerCase();
            const field = document.getElementById('field').value;
            const documentType = document.getElementById('documentType').value;
            const language = document.getElementById('language').value;
            const society = document.getElementById('society').value;
            
            // 検索条件に合致するアイテムをフィルタリング
            const results = mockData.filter(item => {
                // キーワード検索
                const keywordMatch = !keyword || 
                    item.title.toLowerCase().includes(keyword) || 
                    item.authors.toLowerCase().includes(keyword);
                
                // 分野フィルタリング
                const fieldMatch = field === 'all' || item.field === field;
                
                // 文献タイプフィルタリング
                const typeMatch = documentType === 'all' || item.type === documentType;
                
                // 言語フィルタリング
                const languageMatch = language === 'all' || item.language === language;
                
                // 学会フィルタリング
                const societyMatch = society === 'all' || item.society === society;
                
                return keywordMatch && fieldMatch && typeMatch && languageMatch && societyMatch;
            });
            
            // 検索結果の表示
            displayResults(results);
        });
        
        // 検索結果の表示
        function displayResults(results) {
            const resultsContainer = document.getElementById('searchResults');
            const bulkDownloadBtn = document.getElementById('bulkDownload');
            
            // 結果がない場合
            if (results.length === 0) {
                resultsContainer.innerHTML = '<p class="text-center text-muted">検索条件に一致する結果はありませんでした。</p>';
                bulkDownloadBtn.style.display = 'none';
                return;
            }
            
            // 一括ダウンロードボタンの表示
            bulkDownloadBtn.style.display = 'block';
            
            // 結果の表示
            let html = '';
            results.forEach(item => {
                const isDownloaded = isItemDownloaded(item.id);
                const itemClass = isDownloaded ? 'result-item downloaded' : 'result-item';
                const btnText = isDownloaded ? 'ダウンロード済' : 'ダウンロード';
                const btnClass = isDownloaded ? 'btn-secondary' : 'btn-primary';
                const btnDisabled = isDownloaded ? 'disabled' : '';
                
                // 文献タイプに応じたバッジの色
                const typeBadgeClass = item.type === 'guideline' ? 'bg-success' : 'bg-primary';
                const typeText = item.type === 'guideline' ? 'ガイドライン' : '論文';
                
                // 言語バッジの色
                const langBadgeClass = item.language === 'ja' ? 'bg-info' : 'bg-warning';
                const langText = item.language === 'ja' ? '日本語' : '英語';
                
                html += `
                <div class="${itemClass}" data-id="${item.id}">
                    <div class="d-flex justify-content-between align-items-start mb-2">
                        <h5>${item.title}</h5>
                        <span class="badge ${typeBadgeClass} badge-evidence">${typeText}</span>
                    </div>
                    <p class="mb-1"><strong>著者:</strong> ${item.authors}</p>
                    <p class="mb-1"><strong>出典:</strong> ${item.journal}</p>
                    <p class="mb-1"><strong>発行日:</strong> ${item.date}</p>
                    <div class="d-flex align-items-center mt-2">
                        <span class="badge ${langBadgeClass} badge-language me-2">${langText}</span>
                        <a href="${item.url}" target="_blank" class="btn btn-outline-primary btn-sm me-2">詳細を見る</a>
                        <button class="btn ${btnClass} btn-sm btn-download" data-id="${item.id}" data-url="${item.pdfUrl}" ${btnDisabled}>${btnText}</button>
                    </div>
                </div>
                `;
            });
            
            resultsContainer.innerHTML = html;
            
            // ダウンロードボタンのイベントリスナー
            document.querySelectorAll('.btn-download').forEach(btn => {
                if (!btn.disabled) {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        const url = this.getAttribute('data-url');
                        downloadItem(id, url);
                        
                        // ボタンとアイテムの表示を更新
                        this.textContent = 'ダウンロード済';
                        this.classList.replace('btn-primary', 'btn-secondary');
                        this.disabled = true;
                        this.closest('.result-item').classList.add('downloaded');
                    });
                }
            });
            
            // 一括ダウンロードボタンのイベントリスナー
            bulkDownloadBtn.addEventListener('click', function() {
                const undownloadedItems = results.filter(item => !isItemDownloaded(item.id));
                
                if (undownloadedItems.length === 0) {
                    alert('すべてのアイテムはすでにダウンロード済みです。');
                    return;
                }
                
                // 未ダウンロードのアイテムをダウンロード
                undownloadedItems.forEach(item => {
                    downloadItem(item.id, item.pdfUrl);
                    
                    // 対応するボタンとアイテムの表示を更新
                    const btn = document.querySelector(`.btn-download[data-id="${item.id}"]`);
                    if (btn) {
                        btn.textContent = 'ダウンロード済';
                        btn.classList.replace('btn-primary', 'btn-secondary');
                        btn.disabled = true;
                        btn.closest('.result-item').classList.add('downloaded');
                    }
                });
                
                alert(`${undownloadedItems.length}件のアイテムをダウンロードしました。`);
            });
        }
        
        // アイテムのダウンロード
        function downloadItem(id, url) {
            // 実際のダウンロード処理
            // 注: 実際のAPIでは、PDFファイルをダウンロードするためのコードに置き換えます
            console.log(`Downloading item ${id} from ${url}`);
            
            // ダウンロード済みとしてマーク
            saveDownloadedItem(id);
            
            // PDFファイルのダウンロードをシミュレート
            // 実際のアプリケーションでは、window.open(url)やfetch APIを使用してダウンロードします
            const a = document.createElement('a');
            a.href = url;
            a.target = '_blank';
            a.download = `dental-guideline-${id}.pdf`;
            a.click();
        }
        
        // 初期表示時に検索フォームをリセット
        window.addEventListener('load', function() {
            document.getElementById('searchForm').reset();
        });
    </script>
</body>
</html>
