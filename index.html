<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>歯科系ガイドライン・論文検索</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            padding-top: 20px;
            padding-bottom: 40px;
        }
        .result-card {
            margin-bottom: 15px;
            border-left: 4px solid #0d6efd;
        }
        .evidence-badge {
            font-size: 0.8rem;
        }
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        .footer {
            margin-top: 30px;
            padding: 20px 0;
            border-top: 1px solid #e5e5e5;
            color: #777;
        }
        .downloaded {
            background-color: #f8f9fa;
            border-left: 4px solid #28a745;
        }
        .downloaded-badge {
            background-color: #28a745;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            font-size: 0.7rem;
            margin-left: 5px;
        }
        @media (max-width: 768px) {
            .btn-responsive {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="mb-4">
            <h1 class="text-center">歯科系ガイドライン・論文検索</h1>
            <p class="text-center text-muted">日本とアメリカの主要な歯科系学会のガイドラインとエビデンスレベルの高い論文を検索</p>
        </header>

        <div class="row">
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5>検索条件</h5>
                    </div>
                    <div class="card-body">
                        <form id="searchForm">
                            <div class="mb-3">
                                <label for="keyword" class="form-label">キーワード</label>
                                <input type="text" class="form-control" id="keyword" name="keyword" placeholder="例: 歯周病 治療">
                            </div>
                            <div class="mb-3">
                                <label for="field" class="form-label">分野</label>
                                <select class="form-select" id="field" name="field">
                                    <option value="">すべての分野</option>
                                    <option value="接着修復">接着修復</option>
                                    <option value="保存歯科">保存歯科</option>
                                    <option value="歯内療法">歯内療法</option>
                                    <option value="歯周病">歯周病</option>
                                    <option value="矯正">矯正</option>
                                    <option value="小児歯科">小児歯科</option>
                                    <option value="口腔外科">口腔外科</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="document_type" class="form-label">文献タイプ</label>
                                <select class="form-select" id="document_type" name="document_type">
                                    <option value="">すべてのタイプ</option>
                                    <option value="guideline">ガイドライン</option>
                                    <option value="paper">論文（エビデンスレベルの高いもの）</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="language" class="form-label">言語</label>
                                <select class="form-select" id="language" name="language">
                                    <option value="">すべての言語</option>
                                    <option value="japanese">日本語</option>
                                    <option value="english">英語</option>
                                </select>
                            </div>
                            <button type="submit" class="btn btn-primary w-100">検索</button>
                        </form>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h5>日本の主要歯科学会</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <a href="https://www.jads.jp/" target="_blank">日本歯科医学会</a>
                            </li>
                            <li class="list-group-item">
                                <a href="http://www.hozon.or.jp/" target="_blank">日本歯科保存学会</a>
                            </li>
                            <li class="list-group-item">
                                <a href="https://www.hotetsu.com/" target="_blank">日本補綴歯科学会</a>
                            </li>
                            <li class="list-group-item">
                                <a href="http://www.jsoms.or.jp/" target="_blank">日本口腔外科学会</a>
                            </li>
                            <li class="list-group-item">
                                <a href="https://www.jos.gr.jp/" target="_blank">日本矯正歯科学会</a>
                            </li>
                            <li class="list-group-item">
                                <a href="http://www.jspd.or.jp/" target="_blank">日本小児歯科学会</a>
                            </li>
                            <li class="list-group-item">
                                <a href="https://www.perio.jp/" target="_blank">日本歯周病学会</a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h5>アメリカの主要歯科学会</h5>
                    </div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <a href="https://www.ada.org/" target="_blank">American Dental Association (ADA)</a>
                            </li>
                            <li class="list-group-item">
                                <a href="https://www.aae.org/" target="_blank">American Association of Endodontists</a>
                            </li>
                            <li class="list-group-item">
                                <a href="https://www.perio.org/" target="_blank">American Academy of Periodontology</a>
                            </li>
                            <li class="list-group-item">
                                <a href="https://www.aaoinfo.org/" target="_blank">American Association of Orthodontists</a>
                            </li>
                            <li class="list-group-item">
                                <a href="https://www.aapd.org/" target="_blank">American Academy of Pediatric Dentistry</a>
                            </li>
                            <li class="list-group-item">
                                <a href="https://www.aaoms.org/" target="_blank">American Association of Oral and Maxillofacial Surgeons</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-8">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">検索結果</h5>
                        <div>
                            <button id="downloadAllBtn" class="btn btn-sm btn-success me-2" disabled>一括ダウンロード</button>
                            <button id="exportBtn" class="btn btn-sm btn-secondary" disabled>CSVエクスポート</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="loading" class="loading">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                            <p class="mt-2">論文を検索中...</p>
                        </div>
                        <div id="results">
                            <p class="text-center text-muted">検索条件を入力して「検索」ボタンをクリックしてください。</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="footer text-center">
            <p>&copy; 2025 歯科系ガイドライン・論文検索アプリ</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const searchForm = document.getElementById('searchForm');
            const resultsDiv = document.getElementById('results');
            const loadingDiv = document.getElementById('loading');
            const exportBtn = document.getElementById('exportBtn');
            const downloadAllBtn = document.getElementById('downloadAllBtn');
            
            let currentResults = [];
            let downloadedItems = JSON.parse(localStorage.getItem('downloadedItems') || '[]');

            searchForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 検索開始
                loadingDiv.style.display = 'block';
                resultsDiv.innerHTML = '';
                exportBtn.disabled = true;
                downloadAllBtn.disabled = true;
                
                // キーワードと条件を取得
                const keyword = document.getElementById('keyword').value;
                const field = document.getElementById('field').value;
                const documentType = document.getElementById('document_type').value;
                const language = document.getElementById('language').value;
                
                // PubMed APIの代わりにモックデータを使用
                setTimeout(() => {
                    loadingDiv.style.display = 'none';
                    
                    // モックデータ
                    const mockPapers = getMockPapers(keyword, field, documentType, language);
                    currentResults = mockPapers;
                    
                    if (mockPapers.length === 0) {
                        resultsDiv.innerHTML = '<p class="text-center text-muted">検索条件に一致する論文が見つかりませんでした。</p>';
                        return;
                    }
                    
                    // 検索結果を表示
                    let html = '';
                    mockPapers.forEach((paper, index) => {
                        let typeBadge = '';
                        if (paper.type === 'guideline') {
                            typeBadge = '<span class="badge bg-danger evidence-badge">ガイドライン</span>';
                        } else if (paper.type === 'paper') {
                            typeBadge = '<span class="badge bg-primary evidence-badge">論文</span>';
                        }
                        
                        let languageBadge = '';
                        if (paper.language === 'japanese') {
                            languageBadge = '<span class="badge bg-info evidence-badge">日本語</span>';
                        } else if (paper.language === 'english') {
                            languageBadge = '<span class="badge bg-warning text-dark evidence-badge">英語</span>';
                        }
                        
                        const isDownloaded = downloadedItems.includes(paper.id);
                        const downloadedBadge = isDownloaded ? '<span class="downloaded-badge">ダウンロード済</span>' : '';
                        
                        html += `
                            <div class="card result-card ${isDownloaded ? 'downloaded' : ''}" data-id="${paper.id}">
                                <div class="card-body">
                                    <h5 class="card-title">${paper.title} ${typeBadge} ${languageBadge} ${downloadedBadge}</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">${paper.authors}</h6>
                                    <p class="card-text">
                                        <small class="text-muted">${paper.journal}, ${paper.publication_date}</small>
                                    </p>
                                    <div class="d-flex">
                                        <a href="${paper.url}" class="btn btn-sm btn-outline-primary me-2" target="_blank">詳細を表示</a>
                                        <button class="btn btn-sm btn-outline-success download-btn" data-index="${index}" ${isDownloaded ? 'disabled' : ''}>
                                            ${isDownloaded ? 'ダウンロード済' : 'ダウンロード'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    resultsDiv.innerHTML = html;
                    exportBtn.disabled = false;
                    downloadAllBtn.disabled = false;
                    
                    // ダウンロードボタンのイベントリスナーを追加
                    document.querySelectorAll('.download-btn').forEach(button => {
                        button.addEventListener('click', function() {
                            const index = parseInt(this.getAttribute('data-index'));
                            downloadPaper(currentResults[index]);
                        });
                    });
                }, 1500);
            });
            
            // 一括ダウンロードボタン
            downloadAllBtn.addEventListener('click', function() {
                if (currentResults.length === 0) return;
                
                // まだダウンロードされていないアイテムをフィルタリング
                const notDownloadedItems = currentResults.filter(item => !downloadedItems.includes(item.id));
                
                if (notDownloadedItems.length === 0) {
                    alert('すべての項目はすでにダウンロード済みです。');
                    return;
                }
                
                // 確認ダイアログ
                if (confirm(`${notDownloadedItems.length}件の項目をダウンロードします。よろしいですか？`)) {
                    notDownloadedItems.forEach(item => {
                        downloadPaper(item);
                    });
                }
            });
            
            // 個別ダウンロード関数
            function downloadPaper(paper) {
                // PDFファイルをダウンロードする代わりに、テキストファイルを生成
                const content = `タイトル: ${paper.title}\n著者: ${paper.authors}\nジャーナル: ${paper.journal}\n発行日: ${paper.publication_date}\nURL: ${paper.url}\n\n要約:\nこれは${paper.type === 'guideline' ? 'ガイドライン' : '論文'}のサンプルテキストです。実際のアプリケーションでは、PDFファイルがダウンロードされます。`;
                
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${paper.title.substring(0, 30).replace(/[^\w\s]/gi, '')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                // ダウンロード済みとしてマーク
                if (!downloadedItems.includes(paper.id)) {
                    downloadedItems.push(paper.id);
                    localStorage.setItem('downloadedItems', JSON.stringify(downloadedItems));
                    
                    // UIを更新
                    const paperElement = document.querySelector(`.result-card[data-id="${paper.id}"]`);
                    if (paperElement) {
                        paperElement.classList.add('downloaded');
                        const title = paperElement.querySelector('.card-title');
                        if (!title.innerHTML.includes('ダウンロード済')) {
                            title.innerHTML += ' <span class="downloaded-badge">ダウンロード済</span>';
                        }
                        const downloadBtn = paperElement.querySelector('.download-btn');
                        if (downloadBtn) {
                            downloadBtn.disabled = true;
                            downloadBtn.textContent = 'ダウンロード済';
                        }
                    }
                }
            }
            
            // CSVエクスポート
            exportBtn.addEventListener('click', function() {
                if (currentResults.length === 0) return;
                
                // CSVデータの作成
                let csvContent = "data:text/csv;charset=utf-8,";
                csvContent += "ID,Title,Authors,Journal,Publication Date,Type,Language,URL,Downloaded\r\n";
                
                currentResults.forEach(paper => {
                    const isDownloaded = downloadedItems.includes(paper.id);
                    const row = [
                        paper.id,
                        `"${paper.title}"`,
                        `"${paper.authors}"`,
                        `"${paper.journal}"`,
                        paper.publication_date,
                        paper.type === 'guideline' ? 'ガイドライン' : '論文',
                        paper.language === 'japanese' ? '日本語' : '英語',
                        paper.url,
                        isDownloaded ? 'はい' : 'いいえ'
                    ].join(",");
                    csvContent += row + "\r\n";
                });
                
                // CSVファイルのダウンロード
                const encodedUri = encodeURI(csvContent);
                const link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "dental_papers.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            });
            
            // モックデータを生成する関数
            function getMockPapers(keyword, field, documentType, language) {
                if (!keyword && !field && !documentType && !language) return [];
                
                const mockData = [
                    {
                        id: "jp_guideline_1",
                        title: "歯周病の診断と治療ガイドライン",
                        authors: "日本歯周病学会ガイドライン委員会",
                        journal: "日本歯周病学会誌",
                        publication_date: "2024-01-15",
                        type: "guideline",
                        language: "japanese",
                        url: "https://www.perio.jp/publication/guideline.shtml"
                    },
                    {
                        id: "jp_paper_1",
                        title: "歯周病治療における抗菌薬の効果: システマティックレビュー",
                        authors: "田中一郎, 鈴木次郎, 佐藤三郎",
                        journal: "Journal of Periodontal Research",
                        publication_date: "2023-11-05",
                        type: "paper",
                        language: "japanese",
                        url: "https://pubmed.ncbi.nlm.nih.gov/example1"
                    },
                    {
                        id: "jp_paper_2",
                        title: "接着修復における新規材料の臨床評価: ランダム化比較試験",
                        authors: "山田太郎, 伊藤花子, 高橋健太",
                        journal: "Journal of Adhesive Dentistry",
                        publication_date: "2023-08-22",
                        type: "paper",
                        language: "japanese",
                        url: "https://pubmed.ncbi.nlm.nih.gov/example2"
                    },
                    {
                        id: "jp_guideline_2",
                        title: "小児の齲蝕予防ガイドライン",
                        authors: "日本小児歯科学会",
                        journal: "小児歯科学会誌",
                        publication_date: "2023-06-10",
                        type: "guideline",
                        language: "japanese",
                        url: "http://www.jspd.or.jp/contents/main/proposal/index.html"
                    },
                    {
                        id: "en_paper_1",
                        title: "Long-term Survival Rate of Teeth after Endodontic Treatment",
                        authors: "Johnson R, Smith J, Williams T",
                        journal: "Journal of Endodontics",
                        publication_date: "2023-04-18",
                        type: "paper",
                        language: "english",
                        url: "https://pubmed.ncbi.nlm.nih.gov/example4"
                    },
                    {
                        id: "en_guideline_1",
                        title: "Clinical Practice Guidelines for Orthodontic Treatment",
                        authors: "American Association of Orthodontists",
                        journal: "American Journal of Orthodontics and Dentofacial Orthopedics",
                        publication_date: "2023-02-27",
                        type: "guideline",
                        language: "english",
                        url: "https://www.aaoinfo.org/practice-management/clinical-practice-guidelines/"
                    },
                    {
                        id: "en_paper_2",
                        title: "Effectiveness of Minimally Invasive Approaches in Conservative Dentistry: A Systematic Review",
                        authors: "Brown A, Davis C, Miller E",
                        journal: "Journal of Conservative Dentistry",
                        publication_date: "2022-12-05",
                        type: "paper",
                        language: "english",
                        url: "https://pubmed.ncbi.nlm.nih.gov/example7"
                    },
                    {
                        id: "jp_paper_3",
                        title: "歯内療法後の予後に関する長期的研究",
                        authors: "加藤裕子, 松本龍太郎, 井上智子",
                        journal: "日本歯内療法学会雑誌",
                        publication_date: "2022-10-15",
                        type: "paper",
                        language: "japanese",
                        url: "https://pubmed.ncbi.nlm.nih.gov/example8"
                    },
                    {
                        id: "en_guideline_2",
                        title: "Evidence-Based Clinical Practice Guideline on Antibiotic Use for the Urgent Management of Pulpal- and Periapical-Related Dental Pain and Intraoral Swelling",
                        authors: "American Dental Association",
                        journal: "Journal of the American Dental Association",
                        publication_date: "2022-08-01",
                        type: "guideline",
                        language: "english",
                        url: "https://www.ada.org/resources/research/science/evidence-based-dental-research"
                    },
                    {
                        id: "en_paper_3",
                        title: "Comparison of Different Pain Management Protocols After Oral Surgery",
                        authors: "Thompson L, Garcia J, Wilson K",
                        journal: "Journal of Oral and Maxillofacial Surgery",
                        publication_date: "2022-05-12",
                        type: "paper",
                        language: "english",
                        url: "https://pubmed.ncbi.nlm.nih.gov/example9"
                    }
                ];
                
                // キーワード、分野、文献タイプ、言語でフィルタリング
                return mockData.filter(paper => {
                    const keywordMatch = !keyword || paper.title.toLowerCase().includes(keyword.toLowerCase());
                    const fieldMatch = !field || paper.title.toLowerCase().includes(field.toLowerCase());
                    const typeMatch = !documentType || paper.type === documentType;
                    const languageMatch = !language || paper.language === language;
                    return keywordMatch && fieldMatch && typeMatch && languageMatch;
                });
            }
        });
    </script>
</body>
</html>
